# 📋 تعليمات التنفيذ اليدوي - وردة البيان ERP

## ⚠️ ملاحظة مهمة
يجب تنفيذ ملفات SQL مباشرة في **Supabase SQL Editor** لأن قاعدة البيانات تتطلب صلاحيات `service_role`.

---

## 📍 الخطوات المطلوبة:

### 1️⃣ افتح Supabase Dashboard
1. اذهب إلى: https://supabase.com/dashboard/project/uutfztmqvajmsxnrqeiv
2. سجّل الدخول بحسابك
3. اضغط على **SQL Editor** من القائمة اليسرى

---

### 2️⃣ تنفيذ المخططات (بالترتيب)

#### أ) تنفيذ المخطط الأساسي
1. افتح ملف: `wardah_erp_handover/wardah-migration-schema.sql`
2. انسخ **كامل المحتوى**
3. الصقه في SQL Editor
4. اضغط **Run** (أو Ctrl+Enter)
5. انتظر حتى يكتمل التنفيذ (قد يأخذ 10-20 ثانية)

#### ب) تطبيق سياسات RLS
1. افتح ملف: `wardah_erp_handover/wardah-rls-policies.sql`
2. انسخ **كامل المحتوى**  
3. الصقه في SQL Editor
4. اضغط **Run**
5. انتظر التأكيد

#### ج) تثبيت دوال AVCO
1. افتح ملف: `wardah_erp_handover/wardah-avco-functions.sql`
2. انسخ **كامل المحتوى**
3. الصقه في SQL Editor  
4. اضغط **Run**
5. انتظر التأكيد

---

### 3️⃣ استيراد البيانات

#### بعد تنفيذ الخطوات أعلاه، نفّذ:
```bash
node import-wardah-data.cjs
```

هذا سيستورد:
- ✅ 190 حساب في شجرة الحسابات
- ✅ 73 خريطة حدث محاسبي

---

## ✅ التحقق من النجاح

### في SQL Editor، نفّذ:
```sql
-- التحقق من عدد الحسابات
SELECT COUNT(*) FROM gl_accounts;
-- يجب أن يكون: 190

-- التحقق من خرائط الأحداث
SELECT COUNT(*) FROM gl_mappings;
-- يجب أن يكون: 73

-- عرض بعض الحسابات
SELECT code, name, category FROM gl_accounts LIMIT 10;
```

---

## 🎯 النتيجة المتوقعة

بعد تنفيذ جميع الخطوات:
1. ✅ قاعدة البيانات جاهزة بكامل المخطط
2. ✅ سياسات الأمان (RLS) مفعّلة
3. ✅ دوال AVCO جاهزة
4. ✅ شجرة الحسابات محمّلة (190 حساب)
5. ✅ خرائط الأحداث محمّلة (73 خريطة)

---

## 🆘 في حالة الأخطاء

### إذا ظهر خطأ "table already exists":
- هذا طبيعي! بعض الجداول موجودة مسبقاً
- تجاهل الخطأ وأكمل التنفيذ

### إذا ظهر خطأ "permission denied":
- تأكد أنك تستخدم SQL Editor في Supabase Dashboard
- **لا تستخدم** `psql` من الكمبيوتر مباشرة

### إذا فشل الاستيراد:
- تأكد أن الخطوات 2أ، 2ب، 2ج تم تنفيذها **بالكامل** و**بدون أخطاء**
- أعد محاولة تشغيل: `node import-wardah-data.cjs`

---

## 📞 الدعم

إذا واجهت أي مشكلة، أخبرني بما يلي:
1. أي خطوة تواجه فيها المشكلة؟
2. نص الخطأ بالكامل
3. لقطة شاشة (إن أمكن)
