# ุชุญุณูู ููุฏููู ุงููุจูุนุงุช - Sales Module Enhancement

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุณูู ููุฏููู ุงููุจูุนุงุช ุจุดูู ุดุงูู ูุน ูุฑุงุนุงุฉ ุฃุฏู ุงูุชูุงุตูู ูุงูุนูุงูุงุช ุจูู ุงูููุฏูููุงุช ุงููุฎุชููุฉ.

## ุงููููุงุช ุงูุฌุฏูุฏุฉ

### 1. Enhanced Sales Service
**ุงูููู**: `src/services/enhanced-sales-service.ts`

ุฎุฏูุฉ ุดุงููุฉ ุชุฏูุฑ ุฏูุฑุฉ ุงููุจูุนุงุช ุงููุงููุฉ:

#### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

##### 1. ุฏูุฑุฉ ุงููุจูุนุงุช ุงููุงููุฉ
- **Sales Order** โ **Sales Invoice** โ **Delivery Note** โ **Collection**
- ุฅุฏุงุฑุฉ ุงูุญุงูุงุช ููู ูุฑุญูุฉ
- ุชุชุจุน ุงููููุงุช ุงููุณููุฉ ูุงููุฏููุนุฉ

##### 2. ุงูุชูุงูู ูุน ุงููุฎุฒูู
- โ **ุงูุชุญูู ูู ุชููุฑ ุงููุฎุฒูู** ูุจู ุฅูุดุงุก ุงูุทูุจ/ุงููุงุชูุฑุฉ
- โ **ุฎุตู ุงููุฎุฒูู** ุนูุฏ ุงูุชุณููู ุจุงุณุชุฎุฏุงู AVCO
- โ **ุญุณุงุจ COGS** ูู ุชูููุฉ AVCO ุงูุญุงููุฉ
- โ **ุชุณุฌูู ุญุฑูุงุช ุงููุฎุฒูู** ูู `stock_moves`

##### 3. ุงูุชูุงูู ูุน ุงููุญุงุณุจุฉ
- โ **ูููุฏ ุชููุงุฆูุฉ ุนูุฏ ุฅูุดุงุก ุงููุงุชูุฑุฉ**:
  - ูุฏูู: ุญุณุงุจ ุงูุนููุงุก (1120)
  - ุฏุงุฆู: ุฅูุฑุงุฏุงุช ุงููุจูุนุงุช (4001)
  - ุฏุงุฆู: ุถุฑูุจุฉ ูุฎุฑุฌุงุช (2162)
  
- โ **ูููุฏ COGS ุนูุฏ ุงูุชุณููู**:
  - ูุฏูู: ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ (5001)
  - ุฏุงุฆู: ุงููุฎุฒูู (1130)
  
- โ **ูููุฏ ุงูุชุญุตูู**:
  - ูุฏูู: ุงูููุฏูุฉ/ุงูุจูู (1110/1111)
  - ุฏุงุฆู: ุญุณุงุจ ุงูุนููุงุก (1120)

##### 4. ุฅุฏุงุฑุฉ ุงูุงุฆุชูุงู
- โ **ุงูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู** ูุจู ุฅูุดุงุก ุงูุทูุจ/ุงููุงุชูุฑุฉ
- โ **ุญุณุงุจ ุงูุฑุตูุฏ ุงูุญุงูู** ูู ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ
- โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** ุนูุฏ ุชุฌุงูุฒ ุงูุญุฏ

##### 5. ุงูุชุฑููู ุงูุชููุงุฆู
- โ **ุฃุฑูุงู ุชููุงุฆูุฉ** ููุทูุจุงุช: `SO-000001`
- โ **ุฃุฑูุงู ุชููุงุฆูุฉ** ููููุงุชูุฑ: `SI-000001`
- โ **ุฃุฑูุงู ุชููุงุฆูุฉ** ูุณูุฏุงุช ุงูุชุณููู: `DN-000001`

##### 6. ุฅุฏุงุฑุฉ ุงูุญุงูุงุช
- **Sales Order**: `draft` โ `confirmed` โ `in_production` โ `ready` โ `delivered` โ `cancelled`
- **Sales Invoice**: 
  - Delivery: `pending` โ `partially_delivered` โ `fully_delivered`
  - Payment: `unpaid` โ `partially_paid` โ `paid`
- **Delivery Note**: `draft` โ `confirmed` โ `delivered` โ `cancelled`

##### 7. ุญุณุงุจ ุงูุฑุจุญ
- โ **ุญุณุงุจ ุงูุฑุจุญ ุงููุนูู** ููู ูุงุชูุฑุฉ
- โ **Revenue - COGS = Profit**
- โ **Profit Margin** ููุณุจุฉ ูุฆููุฉ

## ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

### Sales Orders

```typescript
// ุฅูุดุงุก ุทูุจ ูุจูุนุงุช
const result = await createSalesOrder(order, lines);
// - ูุชุญูู ูู ุงููุฎุฒูู
// - ูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู
// - ููุดุฆ ุฑูู ุชููุงุฆู
// - ูุญูุธ ุงูุทูุจ ูุงูุจููุฏ

// ุชุฃููุฏ ุงูุทูุจ
await confirmSalesOrder(orderId);
```

### Sales Invoices

```typescript
// ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช
const result = await createSalesInvoice(invoice);
// - ูุชุญูู ูู ุงููุฎุฒูู
// - ูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู
// - ููุดุฆ ุฑูู ุชููุงุฆู
// - ููุดุฆ ุงูููุฏ ุงููุญุงุณุจู ุชููุงุฆูุงู

// ุฌูุจ ูุงุชูุฑุฉ ูุน ุงูุชูุงุตูู
const invoice = await getSalesInvoiceWithDetails(invoiceId);
```

### Delivery Notes

```typescript
// ุฅูุดุงุก ุณูุฏ ุชุณููู
const result = await createDeliveryNote(delivery);
// - ูุฎุตู ุงููุฎุฒูู (AVCO)
// - ูุญุณุจ COGS
// - ููุดุฆ ููุฏ COGS ุชููุงุฆูุงู
// - ูุญุฏุซ ุญุงูุฉ ุงูุชุณููู ูู ุงููุงุชูุฑุฉ
```

### Collections

```typescript
// ุชุณุฌูู ุชุญุตูู
const result = await recordCustomerCollection(collection);
// - ูุญุฏุซ ุงููุจูุบ ุงููุฏููุน
// - ูุญุฏุซ ุญุงูุฉ ุงูุฏูุน
// - ููุดุฆ ุงูููุฏ ุงููุญุงุณุจู ุชููุงุฆูุงู
```

## ุงูุนูุงูุงุช ุจูู ุงูููุฏูููุงุช

### 1. ูุน ุงููุฎุฒูู (Inventory)
```
Sales Invoice โ Delivery Note โ Inventory Deduction
- ุงูุชุญูู ูู ุงููุฎุฒูู ูุจู ุงูุฅูุดุงุก
- ุฎุตู ุงููููุฉ ุนูุฏ ุงูุชุณููู
- ุงุณุชุฎุฏุงู AVCO ูุญุณุงุจ COGS
- ุชุญุฏูุซ stock_quantity ูู items
- ุชุณุฌูู ูู stock_moves
```

### 2. ูุน ุงููุญุงุณุจุฉ (Accounting)
```
Sales Invoice โ Journal Entry (Revenue)
Delivery Note โ Journal Entry (COGS)
Collection โ Journal Entry (Cash/Bank)
- ุงุณุชุฎุฏุงู JournalService
- ุฑุจุท ุชููุงุฆู ุจุงูุญุณุงุจุงุช
- ูุฑุฌุน ูููุซููุฉ ุงูุฃุตููุฉ
```

### 3. ูุน ุงูุนููุงุก (Customers)
```
Customer โ Credit Limit Check
- ุญุณุงุจ ุงูุฑุตูุฏ ุงูุญุงูู
- ุงูุชุญูู ูู ุงูุญุฏ ุงููุชุงุญ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
```

### 4. ูุน ุงูููุชุฌุงุช (Items)
```
Item โ Stock Check
Item โ AVCO Cost
Item โ Stock Deduction
- ุงูุชุญูู ูู ุงููููุฉ ุงููุชุงุญุฉ
- ูุฑุงุกุฉ cost_price (AVCO)
- ุชุญุฏูุซ stock_quantity
```

## ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุงูุชุญูู ูู ุงูุจูุงูุงุช
- โ ุงูุชุญูู ูู ุงููุฎุฒูู ูุจู ูู ุนูููุฉ
- โ ุงูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู
- โ ุงูุชุญูู ูู ุตุญุฉ ุงููููุงุช
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ

### 2. ุงูุชูุงูู ุงูุชููุงุฆู
- โ ูููุฏ ูุญุงุณุจูุฉ ุชููุงุฆูุฉ
- โ ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆูุงู
- โ ุชุญุฏูุซ ุงูุญุงูุงุช ุชููุงุฆูุงู
- โ ุญุณุงุจ COGS ุชููุงุฆูุงู

### 3. ุฅุฏุงุฑุฉ ุงูุญุงูุงุช
- โ ุชุชุจุน ุญุงูุฉ ุงูุชุณููู
- โ ุชุชุจุน ุญุงูุฉ ุงูุฏูุน
- โ ุชุญุฏูุซ ุชููุงุฆู ููุญุงูุงุช

### 4. ุงูุชุฑููู ุงูุชููุงุฆู
- โ ุฃุฑูุงู ูุชุณูุณูุฉ ููุทูุจุงุช
- โ ุฃุฑูุงู ูุชุณูุณูุฉ ููููุงุชูุฑ
- โ ุฃุฑูุงู ูุชุณูุณูุฉ ูุณูุฏุงุช ุงูุชุณููู

### 5. ุญุณุงุจ ุงูุฑุจุญ
- โ ุญุณุงุจ COGS ูู AVCO
- โ ุญุณุงุจ ุงูุฑุจุญ ุงููุนูู
- โ ุญุณุงุจ ูุณุจุฉ ุงูุฑุจุญ

## ุงูุงุณุชุฎุฏุงู

### ูู ุงูููููุงุช

```typescript
import {
  createSalesOrder,
  createSalesInvoice,
  createDeliveryNote,
  recordCustomerCollection,
  getSalesInvoiceWithDetails,
  calculateInvoiceProfit
} from '@/services/enhanced-sales-service';

// ุฅูุดุงุก ูุงุชูุฑุฉ
const invoice = {
  customer_id: '...',
  invoice_date: '2025-01-15',
  due_date: '2025-02-15',
  subtotal: 1000,
  tax_amount: 150,
  total_amount: 1150,
  lines: [
    {
      item_id: '...',
      quantity: 10,
      unit_price: 100,
      discount_percentage: 0,
      tax_percentage: 15
    }
  ]
};

const result = await createSalesInvoice(invoice);
```

## ุญุงูุฉ ุงูุชูููุฐ

### โ 1. ุฎุฏูุฉ ุงููุจูุนุงุช ุงููุญุณููุฉ
**ุงูููู**: `src/services/enhanced-sales-service.ts`

**ูุง ุชู ุฅูุฌุงุฒู**:
- โ ุฅูุดุงุก ุฎุฏูุฉ ุดุงููุฉ ุชุฏูุฑ ุฏูุฑุฉ ุงููุจูุนุงุช ุงููุงููุฉ
- โ ุฏุนู Sales Orders, Sales Invoices, Delivery Notes, Collections
- โ ุงูุชูุงูู ูุน ุงููุฎุฒูู (AVCO costing, stock deduction)
- โ ุงูุชูุงูู ูุน ุงููุญุงุณุจุฉ (ูููุฏ ุชููุงุฆูุฉ)
- โ ุฅุฏุงุฑุฉ ุงูุงุฆุชูุงู (credit limit checks)
- โ ุงูุชุฑููู ุงูุชููุงุฆู ูููุซุงุฆู
- โ ุญุณุงุจ ุงูุฑุจุญ ูุงูุฑุจุญูุฉ
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ ูุน fallback ูู `org_id` ู `tenant_id`

**ุงูุชุงุฑูุฎ**: ุชู ุงูุฅูุฌุงุฒ

---

### โ 2. ุชุญุฏูุซ ููููุงุช ุงููุงุฌูุฉ ูุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ุงูุฌุฏูุฏุฉ
**ุงููููุงุช ุงููุญุฏุซุฉ**:
- `src/features/sales/index.tsx`
- `src/components/forms/SalesInvoiceForm.tsx`
- `src/components/forms/DeliveryNoteForm.tsx`

**ูุง ุชู ุฅูุฌุงุฒู**:
- โ ุชุญุฏูุซ `SalesInvoiceForm` ูุงุณุชุฎุฏุงู `createSalesInvoice` ูู ุงูุฎุฏูุฉ ุงููุญุณููุฉ
- โ ุชุญุฏูุซ `DeliveryNoteForm` ูุงุณุชุฎุฏุงู `createDeliveryNote` ูู ุงูุฎุฏูุฉ ุงููุญุณููุฉ
- โ ุชุญุฏูุซ `SalesOrdersManagement` ูุนุฑุถ ุงูุญุงูุงุช ุงูุชูุตูููุฉ (delivery_status, payment_status)
- โ ุนุฑุถ ุงููุจุงูุบ ุงููุฏููุนุฉ ูุงูุฑุตูุฏ ุงููุชุจูู
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุฌุฏุงูู ุงูููููุฏุฉ (`sales_orders`, `customer_collections`)
- โ Fallback mechanism ููุฌุฏุงูู ุงููุฎุชููุฉ

**ุงูุชุงุฑูุฎ**: ุชู ุงูุฅูุฌุงุฒ

---

### โ 3. ุฅุถุงูุฉ ุชูุงุฑูุฑ ุงููุจูุนุงุช
**ุงูููู**: `src/services/sales-reports-service.ts` ู `src/features/reports/components/SalesReports.tsx`

**ูุง ุชู ุฅูุฌุงุฒู**:
- โ ุชูุฑูุฑ ุฃุฏุงุก ุงููุจูุนุงุช (Sales Performance Metrics):
  - ุฅุฌูุงูู ุงููุจูุนุงุช
  - ุฅุฌูุงูู ุงูููุงุชูุฑ
  - ูุนุฏู ุงูุชุญุตูู
  - ุงููุจูุบ ุงููุณุชุญู
  
- โ ุชุญููู ูุจูุนุงุช ุงูุนููุงุก (Customer Sales Analysis):
  - ุฅุฌูุงูู ุงููุจูุนุงุช ููู ุนููู
  - ุงููุจูุบ ุงููุณุชุญู ููู ุนููู
  - ูุนุฏู ุงูุชุญุตูู ููู ุนููู
  
- โ ุชุญููู ูุจูุนุงุช ุงูููุชุฌุงุช (Product Sales Analysis):
  - ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ููู ููุชุฌ
  - COGS ููู ููุชุฌ
  - ุงูุฑุจุญ ููู ููุชุฌ
  - ูุงูุด ุงูุฑุจุญ
  
- โ ุงุชุฌุงูุงุช ุงููุจูุนุงุช ุงูุดูุฑูุฉ (Monthly Sales Trends):
  - ุงููุจูุนุงุช ุงูุดูุฑูุฉ
  - ุงูุชุญุตููุงุช ุงูุดูุฑูุฉ
  - ุงูุฑุณูู ุงูุจูุงููุฉ ุงูุชูุงุนููุฉ

**ุงูุชุงุฑูุฎ**: ุชู ุงูุฅูุฌุงุฒ

---

### โ 4. ุฅุถุงูุฉ ุชุญูููุงุช ุงูุฑุจุญูุฉ
**ุงูููู**: `src/services/sales-reports-service.ts` - ุฏุงูุฉ `getProfitabilityAnalysis`

**ูุง ุชู ุฅูุฌุงุฒู**:
- โ ุชุญููู ุงูุฑุจุญูุฉ ุงูุดุงูู:
  - ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช
  - ุฅุฌูุงูู COGS
  - ุฅุฌูุงูู ุงูุฑุจุญ
  - ูุงูุด ุงูุฑุจุญ ุงูุฅุฌูุงูู
  - ุงูุฑุจุญูุฉ ุญุณุจ ุงูุนููู
  - ุงูุฑุจุญูุฉ ุญุณุจ ุงูููุชุฌ
  - ุฃูุถู 10 ุนููุงุก ุฑุจุญูุฉ
  - ุฃูุถู 10 ููุชุฌุงุช ุฑุจุญูุฉ
  
- โ ุชุตุฏูุฑ ุงูุจูุงูุงุช (PDF, Excel)
- โ ููุชุฑุฉ ุญุณุจ ุงูุชุงุฑูุฎ
- โ ุฑุณูู ุจูุงููุฉ ุชูุงุนููุฉ

**ุงูุชุงุฑูุฎ**: ุชู ุงูุฅูุฌุงุฒ

---

### ๐ 5. ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
**ุงูุญุงูุฉ**: ููุฏ ุงูุชุทููุฑ

**ุงููุฎุทุท**:
- ุฅุดุนุงุฑุงุช ุนูุฏ ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู
- ุฅุดุนุงุฑุงุช ุนูุฏ ุงูุชูุงุก ุตูุงุญูุฉ ุงูููุงุชูุฑ
- ุฅุดุนุงุฑุงุช ุนูุฏ ุชุฃุฎุฑ ุงูุฏูุน
- ุฅุดุนุงุฑุงุช ุนูุฏ ุงูุฎูุงุถ ุงููุฎุฒูู
- ุฅุดุนุงุฑุงุช ุนูุฏ ุชุฃููุฏ ุงูุทูุจุงุช

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ุฎุฏูุฉ ุงููุจูุนุงุช ุงููุญุณููุฉ
2. โ ุชุญุฏูุซ ููููุงุช ุงููุงุฌูุฉ ูุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ุงูุฌุฏูุฏุฉ
3. โ ุฅุถุงูุฉ ุชูุงุฑูุฑ ุงููุจูุนุงุช
4. โ ุฅุถุงูุฉ ุชุญูููุงุช ุงูุฑุจุญูุฉ
5. ๐ ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ

## ุงูููุงุญุธุงุช

- ุงูุฎุฏูุฉ ูุชูุงููุฉ ูุน `tenant_id` ู `org_id`
- ุชุฏุนู ุงูุฌุฏุงูู ุงููุฎุชููุฉ ุญุณุจ ุงูุจููุฉ ุงููุนููุฉ
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ ูุน ุฑุณุงุฆู ูุงุถุญุฉ
- ุชุณุฌูู ุชูุตููู ููุนูููุงุช
- **ุชู ุฅุตูุงุญ ูุดููุฉ `org_id` vs `tenant_id`**: ุงูููุฏ ุงูุขู ูุณุชุฎุฏู `org_id` ุฃููุงู (ุงูุนููุฏ ุงูุตุญูุญ) ุซู ูุญุงูู `tenant_id` ูู fallback

