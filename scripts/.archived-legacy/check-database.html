<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            color: #00d9ff;
            text-align: center;
        }
        .section {
            background: #16213e;
            border: 1px solid #0f3460;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .section h2 {
            color: #00d9ff;
            margin-top: 0;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .data {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
        }
        button {
            background: #00d9ff;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #00b8d4;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #00d9ff;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
    
    <div style="text-align: center; margin: 20px 0;">
        <button onclick="checkAllData()">â–¶ï¸ ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="results"></div>

    <script>
        // âš ï¸ SECURITY WARNING: Never hardcode API keys in HTML files!
        // For production, load from environment variables or a secure config endpoint
        // This is a test file - replace with actual environment-based configuration
        const supabaseUrl = window.env?.SUPABASE_URL || 'https://your-project.supabase.co';
        const supabaseKey = window.env?.VITE_SUPABASE_ANON_KEY || 'YOUR_ANON_KEY_HERE';
        
        if (!supabaseUrl || !supabaseKey || supabaseKey === 'YOUR_ANON_KEY_HERE') {
            console.error('âŒ ERROR: Missing Supabase configuration!');
            console.error('Please configure SUPABASE_URL and VITE_SUPABASE_ANON_KEY');
            document.body.innerHTML = '<h1>Configuration Error</h1><p>Please set up Supabase credentials. See README_ENV_SETUP.md</p>';
        }
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function checkAllData() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>';
            
            let html = '';

            // 1. Check gl_entries
            html += '<div class="section">';
            html += '<h2>1ï¸âƒ£ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© (gl_entries)</h2>';
            try {
                const { data, error } = await supabase
                    .from('gl_entries')
                    .select('*')
                    .limit(10);
                
                if (error) throw error;
                
                html += `<p class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data?.length || 0} Ù‚ÙŠØ¯</p>`;
                
                if (data && data.length > 0) {
                    html += '<div class="data">';
                    data.forEach(entry => {
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #1a1a2e; border-radius: 5px;">
                                <strong>${entry.entry_number}</strong><br>
                                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${entry.entry_date}<br>
                                Ø§Ù„Ø­Ø§Ù„Ø©: ${entry.status}<br>
                                Ø§Ù„Ù…Ø¯ÙŠÙ†: ${entry.total_debit} | Ø§Ù„Ø¯Ø§Ø¦Ù†: ${entry.total_credit}<br>
                                org_id: ${entry.org_id}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="error">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯ Ù…Ø³Ø¬Ù„Ø©</p>';
                }
            } catch (error) {
                html += `<p class="error">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
            html += '</div>';

            // 2. Check gl_entry_lines
            html += '<div class="section">';
            html += '<h2>2ï¸âƒ£ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚ÙŠÙˆØ¯ (gl_entry_lines)</h2>';
            try {
                const { data, error } = await supabase
                    .from('gl_entry_lines')
                    .select('*')
                    .limit(10);
                
                if (error) throw error;
                
                html += `<p class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data?.length || 0} Ø³Ø·Ø±</p>`;
                
                if (data && data.length > 0) {
                    html += '<div class="data">';
                    data.slice(0, 5).forEach(line => {
                        html += `
                            <div style="margin: 5px 0;">
                                ${line.account_code} - ${line.account_name}: 
                                Ù…Ø¯ÙŠÙ† ${line.debit_amount} | Ø¯Ø§Ø¦Ù† ${line.credit_amount}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="error">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ù‚ÙŠÙˆØ¯</p>';
                }
            } catch (error) {
                html += `<p class="error">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
            html += '</div>';

            // 3. Check purchase_orders
            html += '<div class="section">';
            html += '<h2>3ï¸âƒ£ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (purchase_orders)</h2>';
            try {
                const { data, error } = await supabase
                    .from('purchase_orders')
                    .select('*')
                    .limit(10);
                
                if (error) throw error;
                
                html += `<p class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data?.length || 0} Ø£Ù…Ø± Ø´Ø±Ø§Ø¡</p>`;
                
                if (data && data.length > 0) {
                    html += '<div class="data">';
                    data.forEach(po => {
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #1a1a2e; border-radius: 5px;">
                                <strong>${po.order_number}</strong><br>
                                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${po.order_date}<br>
                                Ø§Ù„Ø­Ø§Ù„Ø©: ${po.status}<br>
                                Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${po.total_amount} Ø±ÙŠØ§Ù„<br>
                                org_id: ${po.org_id}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="error">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ø´Ø±Ø§Ø¡</p>';
                }
            } catch (error) {
                html += `<p class="error">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
            html += '</div>';

            // 4. Check sales_invoices
            html += '<div class="section">';
            html += '<h2>4ï¸âƒ£ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (sales_invoices)</h2>';
            try {
                const { data, error } = await supabase
                    .from('sales_invoices')
                    .select('*')
                    .limit(10);
                
                if (error) throw error;
                
                html += `<p class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data?.length || 0} ÙØ§ØªÙˆØ±Ø©</p>`;
                
                if (data && data.length > 0) {
                    html += '<div class="data">';
                    data.forEach(invoice => {
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #1a1a2e; border-radius: 5px;">
                                <strong>${invoice.invoice_number}</strong><br>
                                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${invoice.invoice_date}<br>
                                Ø§Ù„Ø­Ø§Ù„Ø©: ${invoice.status}<br>
                                Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${invoice.total_amount} Ø±ÙŠØ§Ù„<br>
                                org_id: ${invoice.org_id}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="error">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª</p>';
                }
            } catch (error) {
                html += `<p class="error">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
            html += '</div>';

            // 5. Check products
            html += '<div class="section">';
            html += '<h2>5ï¸âƒ£ Ø§Ù„Ù…Ù†ØªØ¬ pp500</h2>';
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('product_code', 'pp500')
                    .single();
                
                if (error && error.code !== 'PGRST116') throw error;
                
                if (data) {
                    html += '<p class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬</p>';
                    html += '<div class="data">';
                    html += `
                        <div>
                            <strong>${data.product_name}</strong><br>
                            Ø§Ù„ÙƒÙ…ÙŠØ©: ${data.stock_quantity}<br>
                            Ø§Ù„Ø³Ø¹Ø±: ${data.cost_price} Ø±ÙŠØ§Ù„<br>
                            org_id: ${data.org_id}
                        </div>
                    `;
                    html += '</div>';
                } else {
                    html += '<p class="error">âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ pp500</p>';
                }
            } catch (error) {
                html += `<p class="error">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
            html += '</div>';

            // Summary
            html += '<div class="section">';
            html += '<h2>ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ</h2>';
            html += '<p>Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ <span class="error">0 Ø³Ø¬Ù„Ø§Øª</span>ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ:</p>';
            html += '<ol style="text-align: right;">';
            html += '<li>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ø®ØªØ¨Ø§Ø± run-real-test.cjs Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­</li>';
            html += '<li>Ø£Ùˆ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>';
            html += '<li>Ø£Ùˆ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… org_id Ù…Ø®ØªÙ„Ù</li>';
            html += '</ol>';
            html += '<p><strong>Ø§Ù„Ø­Ù„:</strong> Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± run-real-test.cjs Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>';
            html += '</div>';

            resultsDiv.innerHTML = html;
        }

        // Auto-run on page load
        window.addEventListener('load', () => {
            setTimeout(checkAllData, 500);
        });
    </script>
</body>
</html>
