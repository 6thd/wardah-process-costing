# ๐ ุชูุฑูุฑ ุงููุดุงูู ุงูููุชุดูุฉ - ูุธุงู ูุฑุฏุฉ ERP

**ุชุงุฑูุฎ ุงููุญุต:** 28 ุฃูุชูุจุฑ 2025  
**ููุน ุงููุญุต:** ุชุญููู ุดุงูู ููููุฏ ููุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ููุฑุณ ุงููุดุงูู

1. [ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช](#ูุดุงูู-ูุงุนุฏุฉ-ุงูุจูุงูุงุช)
2. [ูุดุงูู ุงููุตุงุฏูุฉ ูุงูุฃูุงู](#ูุดุงูู-ุงููุตุงุฏูุฉ-ูุงูุฃูุงู)
3. [ูุดุงูู ุงูุฃุฏุงุก](#ูุดุงูู-ุงูุฃุฏุงุก)
4. [ูุดุงูู ุงูุจููุฉ ุงูุจุฑูุฌูุฉ](#ูุดุงูู-ุงูุจููุฉ-ุงูุจุฑูุฌูุฉ)
5. [ูุดุงูู ูุงุฌูุฉ ุงููุณุชุฎุฏู](#ูุดุงูู-ูุงุฌูุฉ-ุงููุณุชุฎุฏู)
6. [ูุดุงูู ุงูุชูุงูู](#ูุดุงูู-ุงูุชูุงูู)

---

## 1. ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ๐ด 1.1 Stack Depth Limit Exceeded (ุญุฑุฌ ุฌุฏุงู)

**ุงููุตู:**  
ุนูุฏ ูุญุงููุฉ ุนุฑุถ ุฏููู ุงูุญุณุงุจุงุช ุงููุฑููุ ูุธูุฑ ุงูุฎุทุฃ:
```
stack depth limit exceeded
```

**ุงูุณุจุจ ุงูุฌุฐุฑู:**
- ุงุณุชุฎุฏุงู Recursive CTEs (Common Table Expressions) ูู PostgreSQL
- ุนูู ุงูุดุฌุฑุฉ ุงููุฑููุฉ ูุชุฌุงูุฒ ุญุฏ Stack ุงูุงูุชุฑุงุถู
- ูู Supabase managed instancesุ ูุง ูููู ุฒูุงุฏุฉ `max_stack_depth`

**ุงููููุน:**
- ูููุงุช SQL ูุชุนุฏุฏุฉ ุชุณุชุฎุฏู `WITH RECURSIVE`
- ุงูุงุณุชุนูุงูุงุช ูู `src/lib/supabase.ts`

**ูุซุงู ุนูู ุงูููุฏ ุงููุดูู:**
```sql
WITH RECURSIVE account_tree AS (
  SELECT * FROM gl_accounts WHERE parent_id IS NULL
  UNION ALL
  SELECT child.* 
  FROM gl_accounts child
  JOIN account_tree parent ON child.parent_id = parent.id
)
SELECT * FROM account_tree;
```

**ุงูุญู ุงููุทุจู (ูุญุชุงุฌ ุงุฎุชุจุงุฑ):**
- ุชู ุฅูุดุงุก `IMPLEMENT_MATERIALIZE_PATH.sql`
- ุงุณุชุฎุฏุงู ltree extension
- ุฅุถุงูุฉ ุนููุฏ `path` ููุฌุฏูู

**ุงูุญู ุงูููุชุฑุญ (ูุญุณู):**
```sql
-- 1. ุชูุนูู ltree
CREATE EXTENSION IF NOT EXISTS ltree;

-- 2. ุฅุถุงูุฉ ุนููุฏ path
ALTER TABLE gl_accounts ADD COLUMN IF NOT EXISTS path ltree;

-- 3. ุฅูุดุงุก index
CREATE INDEX IF NOT EXISTS idx_gl_accounts_path ON gl_accounts USING GIST (path);

-- 4. ุงุณุชุฎุฏุงู path ูู ุงูุงุณุชุนูุงูุงุช
SELECT * FROM gl_accounts 
WHERE path <@ '1.2.3'::ltree  -- ุฌููุน ุงูุฃุจูุงุก
ORDER BY path;
```

**ุงูุฃููููุฉ:** ๐ด ุญุฑุฌุฉ ุฌุฏุงู  
**ุงูููุช ุงูููุฏุฑ:** 2-3 ุฃูุงู  
**ุงููุชุทูุจุงุช:** 
- ูุทูุฑ SQL ุฎุจูุฑ
- ุงุฎุชุจุงุฑ ุดุงูู
- Backup ูุงูู ูููุงุนุฏุฉ

---

### ๐ด 1.2 Tenant ID Issues (ุญุฑุฌ ุฌุฏุงู)

**ุงููุตู:**  
ุงูุจูุงูุงุช ูุง ุชุธูุฑ ูููุณุชุฎุฏููู ุฑุบู ูุฌูุฏูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุซูุงู: 190 ุญุณุงุจ ูู ุงููุงุนุฏุฉุ ููู ูุธูุฑ 7 ููุท).

**ุงูุณุจุจ ุงูุฌุฐุฑู:**
1. **NULL values ูู tenant_id:**
   ```sql
   SELECT COUNT(*) FROM gl_accounts WHERE tenant_id IS NULL;
   -- ุงููุชูุฌุฉ: 183 (ูุนุธู ุงูุญุณุงุจุงุช!)
   ```

2. **ุนุฏู ุฑุจุท ุงููุณุชุฎุฏููู ุจุงูููุธูุงุช:**
   ```sql
   SELECT * FROM user_organizations;
   -- ุงููุชูุฌุฉ: ุฌุฏูู ูุงุฑุบ!
   ```

3. **RLS Policies ุชุตูู ุงูุจูุงูุงุช:**
   ```sql
   -- ุงูุณูุงุณุฉ ุงูุญุงููุฉ:
   CREATE POLICY "Users can view accounts in their organization"
   ON gl_accounts FOR SELECT
   USING (
     tenant_id IN (
       SELECT org_id FROM user_organizations 
       WHERE user_id = auth.uid()
     )
   );
   -- ุงููุดููุฉ: ุฅุฐุง ูู ููู ุงููุณุชุฎุฏู ูุฑุจูุท ุจููุธูุฉุ ูุง ูุฑู ุดูุก!
   ```

**ุงููููุน:**
- ุฌุฏูู `gl_accounts`
- ุฌุฏูู `user_organizations`
- ุฌููุน ุงูุฌุฏุงูู ุงูุชู ุชุณุชุฎุฏู `tenant_id`

**ุงูุญู ุงูููุชุฑุญ:**
```sql
-- ุงูุฎุทูุฉ 1: ุชุญุฏูุฏ org_id ุงูุชุฑุงุถู
DO $$
DECLARE
  default_org_id UUID;
BEGIN
  -- ุฅูุดุงุก ููุธูุฉ ุงูุชุฑุงุถูุฉ ุฅู ูู ุชูู ููุฌูุฏุฉ
  INSERT INTO organizations (id, name, code, is_active)
  VALUES (
    '00000000-0000-0000-0000-000000000001',
    'Wardah Factory',
    'WF-001',
    true
  )
  ON CONFLICT (id) DO NOTHING;
  
  default_org_id := '00000000-0000-0000-0000-000000000001';
  
  -- ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุฌููุน ุงูุญุณุงุจุงุช NULL
  UPDATE gl_accounts 
  SET tenant_id = default_org_id 
  WHERE tenant_id IS NULL;
  
  -- ุงูุฎุทูุฉ 3: ุฑุจุท ุฌููุน ุงููุณุชุฎุฏููู ุจุงูููุธูุฉ
  INSERT INTO user_organizations (user_id, org_id, role)
  SELECT 
    id,
    default_org_id,
    'admin'
  FROM auth.users
  ON CONFLICT (user_id, org_id) DO NOTHING;
  
END $$;

-- ุงูุฎุทูุฉ 4: ุฅุถุงูุฉ NOT NULL constraint
ALTER TABLE gl_accounts 
ALTER COLUMN tenant_id SET NOT NULL;

-- ุงูุฎุทูุฉ 5: ุฅุถุงูุฉ default value ููุฅุฏุฎุงูุงุช ุงูุฌุฏูุฏุฉ
ALTER TABLE gl_accounts 
ALTER COLUMN tenant_id SET DEFAULT '00000000-0000-0000-0000-000000000001'::UUID;
```

**ุงูุฃููููุฉ:** ๐ด ุญุฑุฌุฉ ุฌุฏุงู  
**ุงูููุช ุงูููุฏุฑ:** 1 ููู  
**ุงูุชุฃุซูุฑ:** ูุญู ูุดููุฉ ุนุฏู ุธููุฑ ุงูุจูุงูุงุช

---

### ๐ก 1.3 RLS Policies ุงููุนูุฏุฉ

**ุงููุตู:**  
ุณูุงุณุงุช Row Level Security ูุนูุฏุฉ ุฌุฏุงู ูุชุณุจุจ:
- ุจุทุก ูู ุงูุฃุฏุงุก
- ุฃุฎุทุงุก ูู ุจุนุถ ุงูุงุณุชุนูุงูุงุช
- ุตุนูุจุฉ ูู ุงูุตูุงูุฉ

**ุฃูุซูุฉ ุนูู ุงูุณูุงุณุงุช ุงููุนูุฏุฉ:**
```sql
-- ุณูุงุณุฉ ูุนูุฏุฉ ุฌุฏุงู:
CREATE POLICY "Complex policy with recursive check"
ON gl_accounts FOR SELECT
USING (
  EXISTS (
    WITH RECURSIVE org_tree AS (
      SELECT id FROM organizations WHERE id = tenant_id
      UNION
      SELECT o.id FROM organizations o
      JOIN org_tree ON o.parent_id = org_tree.id
    )
    SELECT 1 FROM org_tree
    WHERE id IN (
      SELECT org_id FROM user_organizations 
      WHERE user_id = auth.uid()
    )
  )
);
```

**ุงููุดุงูู:**
1. ุงุณุชุฎุฏุงู Recursive CTEs ูู RLS (ุจุทุก ุดุฏูุฏ)
2. ุณูุงุณุงุช ูุชุถุงุฑุจุฉ
3. ุนุฏู ูุฌูุฏ ุชุนูููุงุช ุชูุถูุญูุฉ

**ุงูุญู ุงูููุชุฑุญ:**
```sql
-- ุญุฐู ุฌููุน ุงูุณูุงุณุงุช ุงููุนูุฏุฉ
DROP POLICY IF EXISTS "Complex policy with recursive check" ON gl_accounts;

-- ุฅูุดุงุก ุณูุงุณุงุช ุจุณูุทุฉ ููุงุถุญุฉ
-- ุณูุงุณุฉ ุงููุฑุงุกุฉ
CREATE POLICY "select_gl_accounts"
ON gl_accounts FOR SELECT
USING (
  tenant_id IN (
    SELECT org_id FROM user_organizations 
    WHERE user_id = auth.uid()
  )
);

-- ุณูุงุณุฉ ุงูุฅุถุงูุฉ
CREATE POLICY "insert_gl_accounts"
ON gl_accounts FOR INSERT
WITH CHECK (
  tenant_id IN (
    SELECT org_id FROM user_organizations 
    WHERE user_id = auth.uid()
    AND role IN ('admin', 'accountant')
  )
);

-- ุณูุงุณุฉ ุงูุชุญุฏูุซ
CREATE POLICY "update_gl_accounts"
ON gl_accounts FOR UPDATE
USING (
  tenant_id IN (
    SELECT org_id FROM user_organizations 
    WHERE user_id = auth.uid()
    AND role IN ('admin', 'accountant')
  )
);

-- ุณูุงุณุฉ ุงูุญุฐู (ููุฅุฏุงุฑููู ููุท)
CREATE POLICY "delete_gl_accounts"
ON gl_accounts FOR DELETE
USING (
  tenant_id IN (
    SELECT org_id FROM user_organizations 
    WHERE user_id = auth.uid()
    AND role = 'admin'
  )
);
```

**ุงูุฃููููุฉ:** ๐ก ุนุงููุฉ  
**ุงูููุช ุงูููุฏุฑ:** 2-3 ุฃูุงู  
**ุงููุงุฆุฏุฉ:** ุชุญุณูู ุงูุฃุฏุงุก ุจูุณุจุฉ 40-50%

---

### ๐ก 1.4 Column Name Inconsistencies

**ุงููุตู:**  
ุนุฏู ุชูุงูู ุจูู ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูู ุงูููุฏ ูุงููุงุนุฏุฉ.

**ุงูุฃูุซูุฉ:**

| ุงูุฌุฏูู | ุงูุงุณู ุงููุชููุน | ุงูุงุณู ุงููุนูู | ุงููููุน |
|--------|---------------|--------------|---------|
| labor_entries | mo_id | manufacturing_order_id | variance functions |
| overhead_allocations | mo_id | manufacturing_order_id | variance functions |
| stock_moves | reference_id | manufacturing_order_id | WIP view |

**ุงูููุฏ ุงููุดูู:**
```typescript
// ูู src/features/reports/components/VarianceAnalysisReport.tsx
const { data } = await supabase
  .from('labor_entries')
  .select('*')
  .eq('mo_id', moId);  // โ ุฎุทุฃ: ุงูุนููุฏ ุงุณูู manufacturing_order_id
```

**ุงูุญู ุงูููุชุฑุญ:**
```sql
-- ุฎูุงุฑ 1: ุฅุนุงุฏุฉ ุชุณููุฉ ุงูุฃุนูุฏุฉ ูู ุงููุงุนุฏุฉ (ููุตู ุจู)
ALTER TABLE labor_entries 
RENAME COLUMN manufacturing_order_id TO mo_id;

ALTER TABLE overhead_allocations 
RENAME COLUMN manufacturing_order_id TO mo_id;

-- ุฃู ุฎูุงุฑ 2: ุชูุญูุฏ ุงุณุชุฎุฏุงู manufacturing_order_id ูู ูู ููุงู
```

**ุงูุฃููููุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููุช ุงูููุฏุฑ:** 1 ููู  
**ุงูุชุฃุซูุฑ:** ูุญู ุฃุฎุทุงุก ูู ุงูุชูุงุฑูุฑ

---

### ๐ก 1.5 UUID Casting Issues

**ุงููุตู:**  
ุฃุฎุทุงุก ูู ููุงุฑูุฉ UUID ูุน Text.

**ุงูุฎุทุฃ ุงูุดุงุฆุน:**
```
ERROR: operator does not exist: uuid = text
```

**ุงูููุฏ ุงููุดูู:**
```sql
-- ูู WIP view
SELECT * FROM stock_moves sm
JOIN manufacturing_orders mo ON sm.reference_id = mo.id
-- โ ุฎุทุฃ: reference_id ูุฏ ูููู text ุจูููุง mo.id ูู UUID
```

**ุงูุญู:**
```sql
-- ุฅุถุงูุฉ casting ุตุฑูุญ
SELECT * FROM stock_moves sm
JOIN manufacturing_orders mo ON sm.reference_id::text = mo.id::text

-- ุฃู ุงูุฃูุถู: ุชูุญูุฏ ุงูููุน
ALTER TABLE stock_moves 
ALTER COLUMN reference_id TYPE UUID USING reference_id::UUID;
```

**ุงูุฃููููุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููุช ุงูููุฏุฑ:** ูุตู ููู  

---

## 2. ูุดุงูู ุงููุตุงุฏูุฉ ูุงูุฃูุงู

### ๐ด 2.1 ุนุฏู ุญูุงูุฉ ุงููุณุงุฑุงุช (ุญุฑุฌ ุฌุฏุงู)

**ุงููุตู:**  
ุฌููุน ุตูุญุงุช ุงููุธุงู ูุชุงุญุฉ ุจุฏูู ุชุณุฌูู ุฏุฎูู!

**ุงูููุฏ ุงูุญุงูู:**
```typescript
// src/pages/routes.tsx
export const appRouter = createBrowserRouter([
  {
    path: "/",
    element: <AppLayout />,  // โ ูุง ููุฌุฏ ุญูุงูุฉ!
    children: [
      { path: "dashboard/*", element: <DashboardModule /> },
      { path: "general-ledger/*", element: <GeneralLedgerModule /> },
      // ... ุฌููุน ุงููุณุงุฑุงุช ููุชูุญุฉ!
    ]
  }
]);
```

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
// src/components/auth/ProtectedRoute.tsx
import { Navigate, Outlet } from 'react-router-dom';
import { useAuth } from '@/contexts/AuthContext';

export function ProtectedRoute() {
  const { user, loading } = useAuth();
  
  if (loading) {
    return <div>Loading...</div>;
  }
  
  if (!user) {
    return <Navigate to="/login" replace />;
  }
  
  return <Outlet />;
}

// src/pages/routes.tsx
export const appRouter = createBrowserRouter([
  {
    path: "/login",
    element: <LoginPage />
  },
  {
    path: "/",
    element: <ProtectedRoute />,  // โ ูุญูู!
    children: [
      {
        element: <AppLayout />,
        children: [
          { path: "dashboard/*", element: <DashboardModule /> },
          // ... ุจุงูู ุงููุณุงุฑุงุช
        ]
      }
    ]
  }
]);
```

**ุงูุฃููููุฉ:** ๐ด ุญุฑุฌุฉ ุฌุฏุงู  
**ุงูููุช ุงูููุฏุฑ:** 1 ููู  
**ุงูุฃูุงู:** ูููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ

---

### ๐ก 2.2 ุนุฏู ูุฌูุฏ Auth Context

**ุงููุตู:**  
ูุง ููุฌุฏ ูุธุงู ููุญุฏ ูุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุตุงุฏูุฉ.

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
// src/contexts/AuthContext.tsx
import { createContext, useContext, useEffect, useState } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { getSupabase } from '@/lib/supabase';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  loading: boolean;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    const supabase = getSupabase();
    
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });
    
    // Listen for auth changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setSession(session);
        setUser(session?.user ?? null);
        setLoading(false);
      }
    );
    
    return () => subscription.unsubscribe();
  }, []);
  
  const signOut = async () => {
    const supabase = getSupabase();
    await supabase.auth.signOut();
  };
  
  return (
    <AuthContext.Provider value={{ user, session, loading, signOut }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

**ุงูุฃููููุฉ:** ๐ก ุนุงููุฉ  
**ุงูููุช ุงูููุฏุฑ:** ูุตู ููู  

---

## 3. ูุดุงูู ุงูุฃุฏุงุก

### ๐ก 3.1 ุนุฏู ูุฌูุฏ Caching Strategy

**ุงููุตู:**  
ูู ุทูุจ ูุฐูุจ ููุณูุฑูุฑ ุญุชู ููุจูุงูุงุช ุงูุซุงุจุชุฉ.

**ุงูููุฏ ุงูุญุงูู:**
```typescript
// ูู ูุฑุฉ ููุชุญ ุงูุตูุญุฉุ ูุทูุจ ุงูุจูุงูุงุช ูู ุฌุฏูุฏ
const { data: accounts } = useQuery({
  queryKey: ['gl-accounts'],
  queryFn: queryGLAccounts
  // โ ูุง ููุฌุฏ staleTime ุฃู cacheTime!
});
```

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
// src/lib/query-client.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,      // 5 ุฏูุงุฆู
      cacheTime: 10 * 60 * 1000,     // 10 ุฏูุงุฆู
      refetchOnWindowFocus: false,
      refetchOnReconnect: false,
      retry: 1
    }
  }
});

// ุงุณุชุฎุฏุงู ูู App.tsx
<QueryClientProvider client={queryClient}>
  {/* ... */}
</QueryClientProvider>
```

**ุงููุงุฆุฏุฉ:**  
- ุชูููู API calls ุจูุณุจุฉ 60-70%
- ุชุญุณูู ุณุฑุนุฉ ุงูุชุญููู
- ุชูููุฑ bandwidth

**ุงูุฃููููุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููุช ุงูููุฏุฑ:** ูุตู ููู  

---

### ๐ก 3.2 ุงุณุชุฎุฏุงู OFFSET Pagination

**ุงููุตู:**  
ุจุทุก ูู ุชุญููู ุงูุตูุญุงุช ุงููุจูุฑุฉ.

**ุงูููุฏ ุงูุญุงูู:**
```typescript
const { data } = await supabase
  .from('gl_accounts')
  .select('*')
  .range(0, 99);  // โ OFFSET pagination - ุจุทูุก!
```

**ุงููุดููุฉ:**  
ุนูุฏ ุงูุตูุญุฉ 100ุ ูุฌุจ ุนูู PostgreSQL:
1. ูุฑุงุกุฉ 10,000 ุณุฌู
2. ุชุฌุงูู 9,900 ุณุฌู
3. ุฅุฑุฌุงุน 100 ุณุฌู ููุท

**ุงูุญู ุงูููุชุฑุญ (Keyset Pagination):**
```typescript
// ุงูุทูุจ ุงูุฃูู
const { data } = await supabase
  .from('gl_accounts')
  .select('*')
  .order('code', { ascending: true })
  .limit(100);

// ุงูุทูุจ ุงูุชุงูู
const lastCode = data[data.length - 1].code;
const { data: nextPage } = await supabase
  .from('gl_accounts')
  .select('*')
  .gt('code', lastCode)
  .order('code', { ascending: true })
  .limit(100);
```

**ุงููุงุฆุฏุฉ:**  
- ุณุฑุนุฉ ุซุงุจุชุฉ ูููุง ูุงู ุฑูู ุงูุตูุญุฉ
- ุฃุฏุงุก ุฃูุถู ุจู 10-100 ูุฑุฉ ููุตูุญุงุช ุงูุจุนูุฏุฉ

**ุงูุฃููููุฉ:** ๐ข ููุฎูุถุฉ (ุญุงููุงู)  
**ุงูููุช ุงูููุฏุฑ:** 1 ููู  

---

### ๐ก 3.3 Realtime Subscriptions ุบูุฑ ูุญููุฉ

**ุงููุตู:**  
ุงุดุชุฑุงูุงุช Realtime ุชุณุจุจ memory leaks.

**ุงูููุฏ ุงููุดูู:**
```typescript
useEffect(() => {
  const supabase = getSupabase();
  
  const subscription = supabase
    .channel('manufacturing_orders')
    .on('postgres_changes', { ... }, handleChange)
    .subscribe();
  
  // โ ูุง ููุฌุฏ cleanup!
}, []);
```

**ุงูุญู:**
```typescript
useEffect(() => {
  const supabase = getSupabase();
  
  const subscription = supabase
    .channel('manufacturing_orders')
    .on('postgres_changes', { ... }, handleChange)
    .subscribe();
  
  // โ cleanup function
  return () => {
    subscription.unsubscribe();
  };
}, []);
```

**ุงูุฃููููุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููุช ุงูููุฏุฑ:** 1 ููู  

---

## 4. ูุดุงูู ุงูุจููุฉ ุงูุจุฑูุฌูุฉ

### ๐ก 4.1 ุชูุฑุงุฑ Type Definitions

**ุงููุตู:**  
ููุณ ุงูุฃููุงุน ูุนุฑูุฉ ูู ุฃูุงูู ูุชุนุฏุฏุฉ.

**ูุซุงู:**
```typescript
// ูู src/lib/supabase.ts
export interface Item {
  id: string;
  name: string;
  price: number;
}

// ูู src/features/inventory/types.ts
interface Item {  // โ ุชูุฑุงุฑ!
  id: string;
  name: string;
  price: number;
}
```

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
// src/types/database.types.ts
export interface Item {
  id: string;
  name: string;
  price: number;
  // ... ูู ุงูุฎุตุงุฆุต
}

// ุงุณุชุฎุฏุงู ูู ูู ููุงู
import { Item } from '@/types/database.types';
```

**ุงูุฃููููุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููุช ุงูููุฏุฑ:** 2 ุฃูุงู  

---

### ๐ก 4.2 ุนุฏู ูุฌูุฏ API Layer

**ุงููุตู:**  
ูู component ูุชุตู ุจู Supabase ูุจุงุดุฑุฉ.

**ุงููุดููุฉ:**
- ุตุนูุจุฉ ุงูุตูุงูุฉ
- ุชูุฑุงุฑ ุงูููุฏ
- ุตุนูุจุฉ ุงูุชุจุฏูู ูู backend ุขุฎุฑ

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
// src/api/glAccounts.api.ts
export const glAccountsApi = {
  getAll: async () => {
    const supabase = getSupabase();
    const { data, error } = await supabase
      .from('gl_accounts')
      .select('*');
    
    if (error) throw error;
    return data;
  },
  
  getById: async (id: string) => {
    // ...
  },
  
  create: async (account: CreateGLAccountDTO) => {
    // ...
  }
};

// ุงุณุชุฎุฏุงู ูู components
const { data } = useQuery({
  queryKey: ['gl-accounts'],
  queryFn: glAccountsApi.getAll
});
```

**ุงููุงุฆุฏุฉ:**
- ููุฏ ุฃูุธู
- ุณูููุฉ ุงูุตูุงูุฉ
- ุฅููุงููุฉ ุฅุถุงูุฉ validationุ cachingุ error handling ููุญุฏ

**ุงูุฃููููุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููุช ุงูููุฏุฑ:** 1 ุฃุณุจูุน  

---

## 5. ูุดุงูู ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ๐ข 5.1 Error Boundaries ูุญุฏูุฏุฉ

**ุงููุตู:**  
ErrorBoundary ููุฌูุฏ ููู ุบูุฑ ูุณุชุฎุฏู ุจุดูู ูุงูู.

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
// ุฅุถุงูุฉ ErrorBoundary ููู ูุญุฏุฉ
<ErrorBoundary fallback={<ModuleErrorFallback />}>
  <ManufacturingModule />
</ErrorBoundary>
```

**ุงูุฃููููุฉ:** ๐ข ููุฎูุถุฉ  
**ุงูููุช ุงูููุฏุฑ:** ููู ูุงุญุฏ  

---

### ๐ข 5.2 Loading States ุบูุฑ ููุญุฏุฉ

**ุงููุตู:**  
ูู ุตูุญุฉ ููุง loading indicator ูุฎุชูู.

**ุงูุญู:**
```typescript
// src/components/ui/loading-states.tsx
export function TableSkeleton() { /* ... */ }
export function PageLoader() { /* ... */ }
export function CardSkeleton() { /* ... */ }
```

**ุงูุฃููููุฉ:** ๐ข ููุฎูุถุฉ  
**ุงูููุช ุงูููุฏุฑ:** ูุตู ููู  

---

## 6. ูุดุงูู ุงูุชูุงูู

### ๐ก 6.1 ุงูุชูุงูู ุงููุญุงุณุจู ูุงูุต

**ุงููุตู:**  
ุงูุนูููุงุช ูุง ุชุณุฌู ูู ุฏููู ุงูุญุณุงุจุงุช ุชููุงุฆูุงู.

**ูุซุงู:**
- ุดุฑุงุก ููุงุฏ โ ูุง ูุณุฌู ููุฏ ูุญุงุณุจู
- ุจูุน ููุชุฌ โ ูุง ูุณุฌู ููุฏ ูุญุงุณุจู
- ุชุตููุน โ ูุง ูุณุฌู ููุฏ ูุญุงุณุจู

**ุงูุญู ุงููุทููุจ:**
```sql
-- ุฅูุดุงุก trigger functions
CREATE OR REPLACE FUNCTION post_purchase_to_gl()
RETURNS TRIGGER AS $$
BEGIN
  -- ููุฏ ุงูุดุฑุงุก
  INSERT INTO gl_journal_entries (...)
  VALUES (...);
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_post_purchase_to_gl
AFTER INSERT ON purchase_orders
FOR EACH ROW
EXECUTE FUNCTION post_purchase_to_gl();
```

**ุงูุฃููููุฉ:** ๐ก ุนุงููุฉ (ููุธุงู ERP ูุงูู)  
**ุงูููุช ุงูููุฏุฑ:** 2 ุฃุณุงุจูุน  

---

## ๐ ููุฎุต ุงูุฃููููุงุช

### ๐ด ุญุฑุฌุฉ (ูุฌุจ ุฅุตูุงุญูุง ููุฑุงู):
1. Stack Depth Limit โ 2-3 ุฃูุงู
2. Tenant ID Issues โ 1 ููู
3. ุนุฏู ุญูุงูุฉ ุงููุณุงุฑุงุช โ 1 ููู

**ุงููุฌููุน: 4-5 ุฃูุงู**

### ๐ก ุนุงููุฉ (ุฅุตูุงุญ ูู ุงูุฃุณุจูุน ุงูุฃูู):
1. RLS Policies โ 2-3 ุฃูุงู
2. Column Names โ 1 ููู
3. Auth Context โ 0.5 ููู
4. Caching Strategy โ 0.5 ููู

**ุงููุฌููุน: 4-5 ุฃูุงู**

### ๐ข ูุชูุณุทุฉ/ููุฎูุถุฉ (ุจุนุฏ ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ):
1. API Layer โ 1 ุฃุณุจูุน
2. Type Definitions โ 2 ุฃูุงู
3. Realtime Subscriptions โ 1 ููู
4. ุงูุชูุงูู ุงููุญุงุณุจู โ 2 ุฃุณุงุจูุน

---

## ๐ฏ ุงูุชูุตูุงุช ุงูููุฑูุฉ

### ุงูููู:
1. โ ุนูู Backup ูุงูู ูููุงุนุฏุฉ
2. โ ุชูููุฐ ุฅุตูุงุญุงุช Tenant ID
3. โ ุงุฎุชุจุงุฑ ุฏููู ุงูุญุณุงุจุงุช

### ุบุฏุงู:
1. โ ุชุทุจูู Materialized Path
2. โ ุชุจุณูุท RLS Policies
3. โ ุฅุถุงูุฉ Protected Routes

### ุงูุฃุณุจูุน ุงููุงุฏู:
1. โ ุฅูุดุงุก Auth Context
2. โ ุฅุถุงูุฉ Caching
3. โ ุชูุญูุฏ ุฃุณูุงุก ุงูุฃุนูุฏุฉ

---

**ุงูุชูู ุงูุชูุฑูุฑ**  
**ุงููุญูู:** GitHub Copilot  
**ุงูุชุงุฑูุฎ:** 28 ุฃูุชูุจุฑ 2025
